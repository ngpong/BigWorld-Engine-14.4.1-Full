{# EntityExtensionFactory.js template -#}
/*
 *	Entity extension factory definitions.
 *
 *	Do not edit this file, this is automatically generated from
 *	ProcessDefs/GenerateJavaScript.
 */

var ENTITY_TYPES = [
	{% for entity in entityDescriptions -%}
	'{{ entity.name }}'
	{%- if not loop.last %}, 
	{% endif %}
	{%- endfor %}
]


/**
 *	Base class for EntityExtensions.
 */
var EntityExtension = function( entity ) {
	this.entity = entity
}


EntityExtension.prototype.timePrefix = function() 
{
	var time = new Number( Module.timestamp() / Module.stampsPerSecondD() )
	return time.toFixed( 3 )
}


EntityExtension.prototype.entityPrefix = function() 
{
	var prefix = this.entity.entityTypeName() + 
		"Extension(" + this.entity.entityID()

	if (this.entity.isPlayer())
	{
		prefix += "; player"
	}

	prefix += ")"

	if (this.entity.isInWorld())
	{
		prefix += " [pos: " + this.entity.position().toString() + "]"
	}

	return prefix
}


EntityExtension.prototype.debugPrefix = function() {
	return this.timePrefix() + " " + this.entityPrefix();
}


/**
 *	General debugging function that can be used with subclasses. 
 *
 *	Prefixes can be configured via overriding the debugPrefix method, which by
 *	default prints the time and information about the entity.
 *
 *	@param msg	The message to output
 */
EntityExtension.prototype.debug = function( msg ) {
	Module.print( this.debugPrefix() + ": " + msg )
}


EntityExtension.prototype.toString = function() {
	return this.entity.entityTypeName() + " " + this.entity.entityID()
}


EntityExtension.prototype.onBecomePlayer = function() {
	this.debug( "onBecomePlayer" )
}


EntityExtension.prototype.onEnterAoI = function() {
	this.debug( "onEnterAoI" )
}


EntityExtension.prototype.onEnterWorld = function() {
	this.debug( "onEnterWorld" )
}


EntityExtension.prototype.onChangeSpace = function() {
	this.debug( "onChangeSpace" )
}


EntityExtension.prototype.onLeaveWorld = function() {
	this.debug( "onLeaveWorld" )
}


EntityExtension.prototype.onLeaveAoI = function() {
	this.debug( "onLeaveAoI" )
}


EntityExtension.prototype.onBecomeNonPlayer = function() {
	this.debug( "onBecomeNonPlayer" )
}


EntityExtension.prototype.onChangeControl = function( isControlling, 
		isInitialising ) {
	this.debug( "onChangeControl" )
}


{% for entity in entityDescriptions %}

// -----------------------------------------------------------------------------
// Section: {{ entity.name }}
// -----------------------------------------------------------------------------

/**
 *	Default implementation of extension class for {{ entity.name }}. 
 */
var {{ entity.name }}Extension = function( entity ) {
	this.inheritFrom = EntityExtension
	this.inheritFrom( entity )

	this.debug( "(constructor)" )
}


{{ entity.name }}Extension.prototype = new EntityExtension()


{% for method in entity.clientMethods %}


/**
 *	Client-side method: {{ entity.name }}.{{ method.name }}
 */
{{ entity.name }}Extension.prototype.{{ method.name }} = function({%- for arg in method.args %}
			{% if arg.0 %}{{ arg.0 }}{% else %}arg{{ loop.index0 }}{% endif %}{% if not loop.last %},{% endif %}
			{%- endfor %} ) {
	this.debug( "method {{ method.name }}" )
}


{%- for property in entity.cellToClientProperties %}


/** 
 *	Setter callback for {{ entity.name }}.{{ property.name }}.
 */
{{ entity.name }}Extension.prototype.set_{{ property.name }} = function( oldValue ) {
	this.debug( "set_{{ property.name }}" + 
		"( " + oldValue + " => " + this.entity.{{ property.name }}() + " )" )
}


{%- if not property.isConst %}


/** 
 *	Setter callback for nested sub-property of {{ entity.name }}.{{ property.name }}.
 *
 *	@param path		The path to the sub-property.
 *	@param oldValue	The previous value of the property.
 */
{{ entity.name }}Extension.prototype.setNested_{{ property.name }} = function( path, oldValue ) {
	this.debug( "setNested_{{ property.name }}" )
	this.set_{{ property.name }}( oldValue );
}


/**
 *	Setter callback for slice of {{ entity.name }}.{{ property.name }}.
 *
 *	@param path			The path to the sub-property.
 *	@param startIndex	The start index of the slice.
 *	@param endIndex		The end index of the slice.
 *	@param oldValue		The previous value.
 */
{{ entity.name }}Extension.prototype.setSlice_{{ property.name }} = function( path, startIndex, endIndex, oldValue ) {
	this.debug( "setSlice_{{ property.name }}" )
	this.set_{{ property.name }}( oldValue );
}
{%- endif -%}
{%- endfor -%}
{%- endfor -%}
{%- endfor %}


/**
 *	The entity extension factory. Override the creation functions if you need
 *	to customise the extension creation.
 */
var EntityExtensionFactory = function() {
}


{%- for entity in entityDescriptions %}


EntityExtensionFactory.prototype.createFor{{ entity.name }} = function( entity ) {
	return new {{ entity.name }}Extension( entity )
}

{%- endfor %}


// EntityExtensionFactory.js
